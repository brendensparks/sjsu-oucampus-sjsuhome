/*
 * Copyright (C) 2006 Google Inc.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *      http://www.apache.org/licenses/LICENSE-2.0
 *      
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*
 * Search-as-you-type
 */

var searchAsYouTypeConfiguration={resourcesPath:"https://www.sjsu.edu/sayt/",ajaxResponderUrl:"https://www.sjsu.edu/sayt/responder.php",helpPageUrl:"",maxFullResults:4,keystrokeDelay:5,showResultsDelay:10,bottomPageMargin:10};function SearchAsYouType(){}
SearchAsYouType.prototype.initialize=function(a,b){this.initializeVariables_(a);this.detectBrowser_();this.attachStylesheets_();this.createDomElements_();this.restoreInputField_();this.addEventHandlers_();this.prepareRandomTip_();this.updateDimensionsAndShadow_(null);this.debugMode&&this.activateDebugConsole_();b&&this.focusInputField_();this.initialized=!0};
SearchAsYouType.prototype.initializeVariables_=function(a){this.location=""+window.location;this.protocol="https";this.resourcesPath=searchAsYouTypeConfiguration.resourcesPath;this.ajaxObject=null;this.results={};this.searchCache=[];this.waitingForSearchResults=this.initialized=!1;this.resultsWindowHidden=!0;this.inputFieldEl=a;this.typedQuery=this.getInputFieldValue_();this.inputFieldHasFocus=this.alternateSearchResultsEl=this.searchResultsEl=0;this.activeResult=-1;this.arrowKeyProcessed=this.resultsWindowHiddenByClicking=
!1;this.lastKeyPressed=0;this.keystrokeTimeoutId=this.showResultsTimeoutId=-1;this.autocomplete="";this.autocompleteJustCollapsed=!1;this.tipText="";this.debugMode=-1<this.location.indexOf("debugSearchAsYouType")};
SearchAsYouType.prototype.detectBrowser_=function(){this.browserSafari=this.browserFirefox=this.browserIE=!1;-1<navigator.userAgent.indexOf("MSIE")?this.browserIE=!0:-1<navigator.userAgent.indexOf("Firefox/")?(this.browserFirefox=!0,this.browserFirefox10=-1<navigator.userAgent.indexOf("Firefox/1.0.")?!0:!1):-1<navigator.userAgent.indexOf("Safari")&&(this.browserSafari=!0,-1<navigator.userAgent.indexOf("Version/")&&(this.browserSafari3OrHigher=!0))};
SearchAsYouType.prototype.attachStylesheets_=function(){this.attachStylesheet_("generic.css");this.attachStylesheet_("customized.css");this.browserIE?this.attachStylesheet_("ie.css"):this.browserSafari&&this.attachStylesheet_("safari.css")};SearchAsYouType.prototype.attachStylesheet_=function(a){var b=document.createElement("link");b.href=this.resourcesPath+"styles/"+a;b.type="text/css";b.rel="stylesheet";document.getElementsByTagName("head").item(0).appendChild(b)};
SearchAsYouType.prototype.createDomElements_=function(){var a=document.createElement("input");a.id="searchAsYouTypeBackupSearchField";a.style.display="none";document.body.appendChild(a);this.searchResultsEl=document.createElement("div");this.searchResultsEl.id="searchAsYouTypeResults1";this.searchResultsEl.className="searchResults";this.searchResultsEl.style.display="none";this.searchResultsEl.style.position="absolute";this.searchResultsEl.onclick="event.cancelBubble = true;";this.searchResultsEl.tabIndex=
-1;this.alternateSearchResultsEl=document.createElement("div");this.alternateSearchResultsEl.id="searchAsYouTypeResults2";this.alternateSearchResultsEl.className="searchResults";this.alternateSearchResultsEl.style.display="none";this.alternateSearchResultsEl.style.position="absolute";this.alternateSearchResultsEl.onclick="event.cancelBubble = true;";this.alternateSearchResultsEl.tabIndex=-1;this.searchResultsShadowEl=document.createElement("div");this.searchResultsShadowEl.id="searchAsYouTypeResultsShadow";
this.searchResultsShadowEl.style.visibility="hidden";this.searchResultsShadowEl.style.display="none";this.searchResultsShadowEl.style.left=0;this.searchResultsShadowEl.style.top=0;this.searchResultsShadowEl.style.width=0;this.searchResultsShadowEl.style.height=0;a=document.createElement("div");a.id="searchAsYouTypeResultsShadowL";this.searchResultsShadowEl.appendChild(a);a=document.createElement("div");a.id="searchAsYouTypeResultsShadowR";this.searchResultsShadowEl.appendChild(a);a=document.createElement("div");
a.id="searchAsYouTypeResultsShadowB";this.searchResultsShadowEl.appendChild(a);a=document.createElement("div");a.id="searchAsYouTypeResultsShadowBL";this.searchResultsShadowEl.appendChild(a);a=document.createElement("div");a.id="searchAsYouTypeResultsShadowBR";this.searchResultsShadowEl.appendChild(a);a=document.createElement("div");a.id="searchAsYouTypeResultsShadowTL";this.searchResultsShadowEl.appendChild(a);a=document.createElement("div");a.id="searchAsYouTypeResultsShadowTR";this.searchResultsShadowEl.appendChild(a);
a=document.createElement("searchAsYouType");a.id="searchAsYouType";a.appendChild(this.searchResultsEl);a.appendChild(this.alternateSearchResultsEl);a.appendChild(this.searchResultsShadowEl);document.body.appendChild(a);this.waitingForSearchResultsEl=document.createElement("img");this.waitingForSearchResultsEl.style.visibility="hidden";this.waitingForSearchResultsEl.style.position="absolute";this.waitingForSearchResultsEl.src=this.resourcesPath+"/images/loading.gif";this.waitingForSearchResultsEl.alt=
"loading";document.body.appendChild(this.waitingForSearchResultsEl);this.autocompleteEl=document.createElement("div");this.autocompleteEl.id="searchAsYouTypeAutocomplete";this.autocompleteEl.className="searchAsYouTypeAutocompleteInputMatch";document.body.appendChild(this.autocompleteEl);this.autocompleteEl.onmousedown=searchAsYouTypeBind(this.handleAutocompleteMouseDown,this);this.autocompleteEl.style.zIndex=5E3;this.autocompleteEl.style.display="none";this.autocompleteHelperEl=document.createElement("div");
this.autocompleteHelperEl.id="searchAsYouTypeAutocompleteHelper";this.autocompleteHelperEl.visibility="hidden";this.autocompleteHelperEl.className="searchAsYouTypeAutocompleteInputMatch";document.body.appendChild(this.autocompleteHelperEl)};SearchAsYouType.prototype.getInputFieldValue_=function(){return this.inputFieldEl.value.toLowerCase().replace(/^\s+/g,"").replace(/\s+$/g,"")};
SearchAsYouType.prototype.focusInputField_=function(){this.inputFieldEl.focus();if(this.inputFieldEl.createTextRange&&window.document.selection){var a=this.inputFieldEl.createTextRange();a.collapse(!0);a.move("character",this.inputFieldEl.value.length);a.select()}};SearchAsYouType.prototype.clearInputField_=function(){this.inputFieldEl.value="";this.clearAutocomplete_(!0);this.prepareRandomTip_()};
SearchAsYouType.prototype.saveInputField=function(){document.getElementById("searchAsYouTypeBackupSearchField").value=this.inputFieldEl.value;document.getElementById("searchAsYouTypeBackupSearchField").setAttribute("active",1)};SearchAsYouType.prototype.restoreInputField_=function(){document.getElementById("searchAsYouTypeBackupSearchField").getAttribute("active")&&(this.inputFieldEl.value=document.getElementById("searchAsYouTypeBackupSearchField").value,this.typedQuery=this.getInputFieldValue_())};
SearchAsYouType.prototype.addEventHandlers_=function(){this.inputFieldEl.onkeyup=searchAsYouTypeBind(this.handleInputKeyUp,this);this.inputFieldEl.onkeypress=searchAsYouTypeBind(this.handleInputKeyPress,this);this.inputFieldEl.onkeydown=searchAsYouTypeBind(this.handleInputKeyDown,this);this.inputFieldEl.onfocus=searchAsYouTypeBind(this.handleInputFocus,this);this.inputFieldEl.onblur=searchAsYouTypeBind(this.handleInputBlur,this);this.inputFieldEl.onclick=searchAsYouTypeBind(this.handleInputClick,
this);this.inputFieldEl.onmousedown=searchAsYouTypeBind(this.handleInputMouseDown,this);this.inputFieldEl.setAttribute("autocomplete","off");window.addEventListener?(document.body.addEventListener("click",searchAsYouTypeBind(this.handleBodyClick,this),!1),document.addEventListener("keyup",searchAsYouTypeBind(this.handleBodyKeyUp,this),!1),document.addEventListener("keydown",searchAsYouTypeBind(this.handleBodyKeyDown,this),!1),document.addEventListener("keypress",searchAsYouTypeBind(this.handleBodyKeyPress,
this),!1),window.addEventListener("resize",searchAsYouTypeBind(this.handleBodyResize,this),!1)):(document.body.attachEvent("onclick",searchAsYouTypeBind(this.handleBodyClick,this)),document.body.attachEvent("onkeyup",searchAsYouTypeBind(this.handleBodyKeyUp,this)),document.body.attachEvent("onkeydown",searchAsYouTypeBind(this.handleBodyKeyDown,this)),document.onkeypress=searchAsYouTypeBind(this.handleBodyKeyPress,this),window.attachEvent("onresize",searchAsYouTypeBind(this.handleBodyResize,this)));
try{window.onpageshow=function(a){a.persisted&&searchAsYouType.restoreInputField_()}}catch(a){}this.browserFirefox&&!this.browserFirefox10?window.onpagehide=searchAsYouTypeBind(this.saveInputField,this):window.onunload=searchAsYouTypeBind(this.saveInputField,this)};
SearchAsYouType.prototype.prepareRandomTip_=function(){var a=["You can use arrow keys to navigate these results.","Press Tab, space or right arrow to auto-complete.","Press Esc or up arrow to hide this pop-up. Press Esc again to quickly clear the search field.","Click outside this pop-up to hide it. Click on the search bar twice to show it again."];this.tipText=0.05>Math.random()?a[Math.floor(Math.random()*a.length)]:""};
SearchAsYouType.prototype.updateDimensionsAndShadow_=function(a){var b=this.inputFieldEl,c=0,d=0,f=b;do c+=f.offsetLeft,d+=f.offsetTop,f=f.offsetParent;while(f);this.waitingForSearchResultsEl.style.left=c+this.inputFieldEl.offsetWidth-19+"px";this.waitingForSearchResultsEl.style.top=d+3+"px";this.autocompleteEl.setAttribute("originalLeft",c);this.autocompleteEl.style.top=d+"px";this.autocompleteEl.style.height=this.inputFieldEl.clientHeight-1+"px";if(a){d+=b.offsetHeight-2;b=b.offsetWidth-2;a.style.left=
c+1+"px";a.style.top=d+"px";a.style.width=b+"px";c=a.offsetLeft;d=a.offsetTop;b=a.offsetWidth;f=a.scrollHeight;if(self.innerHeight)var e=self.innerHeight;else document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientHeight:document.body&&(e=document.body.clientHeight);e=e-(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)-d-searchAsYouTypeConfiguration.bottomPageMargin;a.style.height=f>e?e+"px":"auto";a=a.offsetHeight;
this.resizeShadowEl_("",c,d,b+4,a+6);this.resizeShadowEl_("L",-2,5,2,a-5);this.resizeShadowEl_("TL",-2,0,2,5);this.resizeShadowEl_("TR",b,0,2,5);this.resizeShadowEl_("R",b,5,2,a-5);this.resizeShadowEl_("B",4,a,b-8,6);this.resizeShadowEl_("BL",-2,a,6,6);this.resizeShadowEl_("BR",b-4,a,6,6)}};SearchAsYouType.prototype.resizeShadowEl_=function(a,b,c,d,f){a=document.getElementById("searchAsYouTypeResultsShadow"+a);try{a.style.left=b+"px",a.style.top=c+"px",a.style.width=d+"px",a.style.height=f+"px"}catch(e){}};
SearchAsYouType.prototype.search_=function(a){this.delayShowResults=!0===a?!1:!0;0==this.typedQuery.length?this.changeWaitingForSearchResults_(!1):(URL=searchAsYouTypeConfiguration.ajaxResponderUrl,URL+="?query="+encodeURIComponent(this.typedQuery),URL+="&jsonp=searchAsYouType.handleAjaxResponse",this.debugMode&&(URL+="&debug=1"),this.waitingForSearchResults&&this.cancelCurrentSearch_(),this.debugMode&&(this.addToDebugConsoleTimesNewLine_("<td>"+this.typedQuery+"</td>"),a=new Date,this.debugQueryStartTime=
a.getTime()),this.changeWaitingForSearchResults_(!0),this.searchCache["_"+this.typedQuery])?(this.ajaxRequestStartTime=-1,this.processResults_(this.searchCache["_"+this.typedQuery].results,!0)):(a=new Date,this.ajaxRequestStartTime=a.getTime(),this.ajaxObject=document.createElement("script"),this.ajaxObject.src=URL,this.ajaxObject.type="text/javascript",this.ajaxObject.charset="utf-8",document.getElementsByTagName("head").item(0).appendChild(this.ajaxObject))};
SearchAsYouType.prototype.cancelCurrentSearch_=function(){if(this.ajaxObject)try{document.getElementsByTagName("head").item(0).removeChild(this.ajaxObject)}catch(a){}};SearchAsYouType.prototype.changeWaitingForSearchResults_=function(a){this.waitingForSearchResults!=a&&(a?this.waitingForSearchResultsEl.style.visibility="visible":(this.waitingForSearchResultsEl.style.visibility="hidden",this.cancelCurrentSearch_()));this.waitingForSearchResults=a};
SearchAsYouType.prototype.handleAjaxResponse=function(a){if(a.results.length&&this.tipText){var b=searchAsYouTypeConfiguration.helpPageUrl,c="<p> "+this.tipText;b&&(c+=' <a unselectable="on" class="unselectable moreDetails" href="'+b+'">Learn more</a>');a.results.push({type:"Tip",name:"",content:c+"</p>",style:"compact",moreDetailsUrl:b})}this.processResults_(a,!1)};
SearchAsYouType.prototype.processResults_=function(a,b){var c=8==this.lastKeyPressed?!0:!1;a.autocompletedQuery||(a.autocompletedQuery=a.query);a.countNotCompact=0;a.countExpanded=0;for(var d in a.results)"expanded"==a.results[d].style?(a.countExpanded++,a.countNotCompact++):"normal"==a.results[d].style&&a.countNotCompact++;this.results=searchAsYouTypeCloneObject(a);this.searchCache["_"+this.results.query]={};this.searchCache["_"+this.results.query].results=searchAsYouTypeCloneObject(a);this.resultsWindowHiddenByClicking=
!1;a.query==this.typedQuery&&((this.debugMode&&(d=(new Date).getTime(),this.addToDebugConsoleTimesCurrentLine_("<td>"+a.autocompletedQuery+"</td>"),this.addToDebugConsoleTimesCurrentLine_("<td>"+a.results.length+"</td>"),this.addToDebugConsoleTimesCurrentLine_("<td>"+searchAsYouTypeConfiguration.showResultsDelay+" ms</td>"),b?this.addToDebugConsoleTimesCurrentLine_("<td colspan='4'>(from cache)</td>"):(this.addToDebugConsoleTimesCurrentLine_("<td class='no'>"+(d-this.debugQueryStartTime)+" ms</td>"),
this.addToDebugConsoleTimesCurrentLine_("<td class='no'>"+this.results.debugInfo.globalTime+" ms</td>"))),b&&c&&this.searchCache["_"+this.results.query].autocompleted)?(this.hideResultsWindow_(),this.changeWaitingForSearchResults_(!1)):this.results.results.length?(this.prepareResultsWindow_(),c||this.addAutocompleteTextIfPossible_()):(this.hideResultsWindow_(),this.changeWaitingForSearchResults_(!1)))};SearchAsYouType.prototype.getResultTypeDescriptionHtml_=function(a){return"<h1>"+a+": </h1>"};
SearchAsYouType.prototype.getResultTypeClassName_=function(a){return a.replace(/\ /g,"")};
SearchAsYouType.prototype.getResultsHtml_=function(a){var b=0,c="",d=null,f=!1,e=["expandedPriority","expanded","normal","compact"],j;for(j in e)for(var g=0;g<this.results.results.length;g++)if(this.results.results[g].style==e[j]){if(-1==a||a==b){var h=-1<a?"expandedPriority":e[j];if("normal"!=h||d!=this.results.results[g].type){f&&(c+="</div>");var i="searchResult "+this.getResultTypeClassName_(this.results.results[g].type);0==b&&(i+=" first");"normal"==h&&(c+='<div class="'+i+' summary" ',c+='onclick="event.cancelBubble = true;" ',
c+=">",d=this.results.results[g].type,c+=this.getResultTypeDescriptionHtml_(this.results.results[g].type),f=!0)}else"normal"==h&&(c+="&nbsp;&middot; ");c="normal"!=h?c+('<div id="searchResult'+b+'" class="'+i+'" originalId="'+g+'" moreDetailsUrl="'+this.results.results[g].moreDetailsUrl+'" onclick="searchAsYouType.handleSearchResultClick(event)">'+this.results.results[g].content+"</div>"):c+('<a  id="searchResult'+b+'" originalId="'+g+'"  onclick="return  searchAsYouType.expandSummaryResult(event, '+
b+')"  class="command nowrap summarized" href="'+this.results.results[g].moreDetailsUrl+'">'+this.results.results[g].name+"</a>")}b++}return c};
SearchAsYouType.prototype.prepareResultsWindow_=function(){this.activeResult=-1;if(this.results.countNotCompact<=searchAsYouTypeConfiguration.maxFullResults)for(var a=0;a<this.results.results.length;a++)"expanded"==this.results.results[a].style?this.results.results[a].style="expandedPriority":"normal"==this.results.results[a].style&&(this.results.results[a].style="expanded");this.resultsHtml=this.getResultsHtml_(-1);-1<this.showResultsTimeoutId&&clearTimeout(this.showResultsTimeoutId);this.delayShowResults?
(a=-1==this.ajaxRequestStartTime?0:(new Date).getTime()-this.ajaxRequestStartTime,a=searchAsYouTypeConfiguration.showResultsDelay-a,1>=a&&(a=1)):a=1;this.showResultsTimeoutId=setTimeout(searchAsYouTypeBind(this.showResultsWindow_,this),a)};
SearchAsYouType.prototype.showResultsWindow_=function(){this.showResultsTimeoutId=-1;this.changeWaitingForSearchResults_(!1);clearInterval(this.hideTimeout);this.resultsWindowHidden=this.resultsWindowHiddenByClicking=!1;for(var a=0,b;b=document.getElementById("searchResult"+a);)b.id="",a++;this.alternateSearchResultsEl.style.height="1px";this.alternateSearchResultsEl.style.visibility="hidden";this.alternateSearchResultsEl.style.display="block";this.alternateSearchResultsEl.innerHTML=this.resultsHtml;
this.alternateSearchResultsEl.style.opacity=0.99;b=this.alternateSearchResultsEl.getElementsByTagName("a");for(var a=0,c=b.length;a<c;a++)b.item(a).tabIndex=-1,b.item(a).target="_top";b=this.alternateSearchResultsEl.getElementsByTagName("img");a=0;for(c=b.length;a<c;a++)b.item(a).style.display="none",b.item(a).onload=searchAsYouTypeBind(this.handleImageOnLoad,this,b.item(a));this.updateDimensionsAndShadow_(this.alternateSearchResultsEl);this.searchResultsEl.style.visibility="hidden";this.searchResultsEl.style.display=
"none";this.searchResultsShadowEl.style.display="block";this.searchResultsShadowEl.style.visibility="visible";this.searchResultsShadowEl.style.opacity=1;this.alternateSearchResultsEl.style.visibility="visible";b=this.searchResultsEl;this.searchResultsEl=this.alternateSearchResultsEl;this.alternateSearchResultsEl=b};SearchAsYouType.prototype.handleImageOnLoad=function(a){a&&(a.style.display="inline",this.updateDimensionsAndShadow_(this.searchResultsEl));return!1};
SearchAsYouType.prototype.hideResultsWindow_=function(){this.resultsWindowHidden||(this.clearAutocomplete_(!0),this.hideOpacity=this.searchResultsEl.style.opacity,clearInterval(this.hideTimeout),this.fadeLastTime=(new Date).getTime(),this.hideTimeout=setInterval(searchAsYouTypeBind(this.fadeResultsWindow_,this),20),this.resultsWindowHidden=!0,this.activeResult=-1)};
SearchAsYouType.prototype.fadeResultsWindow_=function(){var a=(new Date).getTime();this.hideOpacity-=0.005*(a-this.fadeLastTime);this.fadeLastTime=a;0>=this.hideOpacity?(clearInterval(this.hideTimeout),this.searchResultsEl.style.display="none",this.searchResultsShadowEl.style.visibility="hidden"):(this.searchResultsEl.style.opacity=this.hideOpacity,this.searchResultsShadowEl.style.opacity=this.hideOpacity)};
SearchAsYouType.prototype.highlightSearchResult_=function(a){document.getElementById("searchResult"+a).className+=" highlighted"};SearchAsYouType.prototype.unhighlightSearchResult_=function(a){document.getElementById("searchResult"+a).className=document.getElementById("searchResult"+a).className.replace(/ highlighted/,"")};
SearchAsYouType.prototype.highlightNextSearchResult_=function(){this.results.results.length&&(-1==this.activeResult?(this.activeResult=0,this.inputFieldHasFocus&&this.inputFieldEl.blur(),this.highlightSearchResult_(this.activeResult)):this.activeResult<this.results.results.length-1&&(this.unhighlightSearchResult_(this.activeResult),this.activeResult++,this.highlightSearchResult_(this.activeResult)))};
SearchAsYouType.prototype.highlightPrevSearchResult_=function(){this.results.results.length&&(0==this.activeResult?(this.unhighlightSearchResult_(this.activeResult),this.activeResult=-1,this.inputFieldEl.focus()):0<this.activeResult&&(this.unhighlightSearchResult_(this.activeResult),this.activeResult--,this.highlightSearchResult_(this.activeResult)))};
SearchAsYouType.prototype.expandSummaryResult_=function(a,b){if(a=a||window.event)a.cancelBubble=!0;var c=document.createElement("divider"),d=document.getElementById("searchResult"+b),f=this.results.results[d.getAttribute("originalId")],e=d.parentNode;e.insertBefore(c,d);e.removeChild(d);e.parentNode.innerHTML=e.parentNode.innerHTML.replace(/<divider>/,"</div>"+this.getResultsHtml_(b)+"<div class='searchResult summary "+this.getResultTypeClassName_(f.type)+"'>");d=document.getElementById("searchResult"+
b);c=document.createElement("span");c.innerHTML="&nbsp;&middot; ";if(e=d.previousSibling)e.getElementsByTagName("a").length?e.innerHTML=e.innerHTML.replace(RegExp(c.innerHTML+"$"),""):e.parentNode.removeChild(e);if(d=d.nextSibling)d.getElementsByTagName("a").length?d.innerHTML=d.innerHTML.replace(RegExp("^"+c.innerHTML),this.getResultTypeDescriptionHtml_(f.type)):d.parentNode.removeChild(d);this.updateDimensionsAndShadow_(this.searchResultsEl);return!1};
SearchAsYouType.prototype.addAutocompleteTextIfPossible_=function(){var a=this.results;if(a.query){var b=this.getInputFieldValue_().toLowerCase();if(a.query.toLowerCase()==b.substr(0,a.query.length)&&b==a.autocompletedQuery.substr(0,b.length).toLowerCase())return(this.autocomplete=a.autocompletedQuery.substring(b.length))?(a=this.inputFieldEl.value.replace(/\ /,"&nbsp;"),this.autocompleteHelperEl.style.display="block",this.autocompleteHelperEl.innerHTML=a,a=this.autocompleteHelperEl.offsetWidth,this.autocompleteHelperEl.innerHTML=
this.autocomplete,this.autocompleteHelperEl.style.display="none",this.autocompleteEl.innerHTML=this.autocomplete.replace(/\ /,"&nbsp;"),this.autocompleteEl.style.left=parseInt(this.autocompleteEl.getAttribute("originalLeft"))+a+"px",this.autocompleteEl.style.display="block"):this.autocompleteEl.style.display="none",!0;this.clearAutocomplete_(!0);return!1}};
SearchAsYouType.prototype.collapseAutocomplete_=function(){this.autocomplete&&(this.inputFieldEl.value+=this.autocomplete+" ",this.inputFieldEl.selectionStart=this.inputFieldEl.value.length,this.inputFieldEl.selectionEnd=this.inputFieldEl.value.length,this.clearAutocomplete_(!1))};SearchAsYouType.prototype.clearAutocomplete_=function(a){""!=this.autocomplete&&(this.autocomplete="",this.autocompleteEl.innerHTML="",this.autocompleteEl.style.display="none",a&&this.hideResultsWindow_())};
SearchAsYouType.prototype.handleInputKeyPress=function(a){if(this.initialized){var b=!0,a=a||window.event;switch(a.which?a.which:a.keyCode){case 9:this.autocompleteJustCollapsed&&(b=!1)}return b}};SearchAsYouType.prototype.handleInputKeyDown=function(a){this.initialized&&(a=a||window.event,a=a.which?a.which:a.keyCode,(8==a||46==a)&&this.clearAutocomplete_(!1))};
SearchAsYouType.prototype.handleInputKeyUp=function(a){if(this.initialized)if(a=a||window.event,this.lastKeyPressed=a=a.which?a.which:a.keyCode,this.autocompleteJustCollapsed)this.typedQuery=this.lastTypedQuery=this.getInputFieldValue_(),this.autocompleteJustCollapsed=!1;else{if(this.getInputFieldValue_()!=this.typedQuery&&(-1<this.showResultsTimeoutId&&clearTimeout(this.showResultsTimeoutId),this.lastTypedQuery=this.typedQuery,8!=a&&this.addAutocompleteTextIfPossible_()&&(this.typedQuery=this.lastTypedQuery=
this.getInputFieldValue_(),this.search_()),this.typedQuery=this.getInputFieldValue_(),this.lastTypedQuery!=this.typedQuery))-1!=this.keystrokeTimeoutId&&(clearTimeout(this.keystrokeTimeoutId),this.keystrokeTimeoutId=-1),this.typedQuery||(this.hideResultsWindow_(),this.clearInputField_()),8==a&&this.clearAutocomplete_(!0),this.keystrokeTimeoutId=setTimeout(searchAsYouTypeBind(this.search_,this),searchAsYouTypeConfiguration.keystrokeDelay);return!0}};
SearchAsYouType.prototype.handleBodyKeyDown=function(a){var b=!0;if(this.initialized){var a=a||window.event,c=a.which?a.which:a.keyCode;switch(c){case 13:case 32:if(!this.resultsWindowHidden&&0<=this.activeResult){if(-1==document.getElementById("searchResult"+this.activeResult).className.indexOf("summarized")){b=document.getElementById("searchResult"+this.activeResult);if(b.href)var d=b.href;else b.getAttribute("moreDetailsUrl")&&(d=b.getAttribute("moreDetailsUrl"));d&&(this.hideResultsWindow_(),
this.goToUrl_(d))}else this.expandSummaryResult_(null,this.activeResult),this.highlightSearchResult_(this.activeResult);b=!1}break;case 27:if(this.inputFieldHasFocus){if(this.browserSafari&&!this.browserSafari3OrHigher)if(this.escapeKeyJustPressed){this.escapeKeyJustPressed=!1;break}else this.escapeKeyJustPressed=!0;this.resultsWindowHidden?(this.clearInputField_(),b=!1):(this.hideResultsWindow_(),b=!1,this.inputFieldEl.focus(),this.inputFieldHasFocus=1)}break;case 35:this.inputFieldHasFocus&&""!=
this.autocomplete&&(this.collapseAutocomplete_(),this.autocompleteJustCollapsed=!0);break;case 40:case 63233:case 39:39==c&&this.inputFieldHasFocus&&""!=this.autocomplete&&(this.collapseAutocomplete_(),this.autocompleteJustCollapsed=!0);if(this.resultsWindowHidden&&this.inputFieldHasFocus&&39!=c)this.search_(!0),b=!1;else if(!this.resultsWindowHidden&&(0<=this.activeResult||39!=c&&this.inputFieldHasFocus))this.highlightNextSearchResult_(),b=!1,this.arrowKeyProcessed=!0;break;case 38:case 63235:case 37:37==
c&&this.clearAutocomplete_(!0);!this.resultsWindowHidden&&this.inputFieldHasFocus&&37!=c?(this.hideResultsWindow_(),b=!1,this.arrowKeyProcessed=!0):!this.resultsWindowHidden&&0<=this.activeResult&&(this.highlightPrevSearchResult_(),b=!1,this.arrowKeyProcessed=!0);break;case 9:this.inputFieldHasFocus&&""!=this.autocomplete&&(this.collapseAutocomplete_(),this.autocompleteJustCollapsed=!0,b=!1)}!this.resultsWindowHidden&&b&&(!this.inputFieldHasFocus&&(37>c||40<c)||9==c&&!this.autocompleteJustCollapsed)&&
this.hideResultsWindow_();b||(a.returnValue=!1,a.preventDefault&&a.preventDefault())}};SearchAsYouType.prototype.handleBodyKeyPress=function(a){var b=!0;if(this.initialized){var a=a||window.event,c=a.which?a.which:a.keyCode;this.arrowKeyProcessed&&37<=c&&40>=c&&(b=this.arrowKeyProcessed=!1);b||(a.returnValue=!1,a.preventDefault&&a.preventDefault())}};
SearchAsYouType.prototype.handleBodyKeyUp=function(a){var b=!0,a=a||window.event,c=a.which?a.which:a.keyCode;this.arrowKeyProcessed=!1;switch(c){case 32:this.inputFieldHasFocus&&""!=this.autocomplete&&(this.clearAutocomplete_(!0),b=!1)}b||(a.returnValue=!1,a.preventDefault&&a.preventDefault())};SearchAsYouType.prototype.handleBodyResize=function(){this.updateDimensionsAndShadow_(this.searchResultsEl)};SearchAsYouType.prototype.handleInputBlur=function(){this.inputFieldHasFocus=0};
SearchAsYouType.prototype.handleInputFocus=function(){this.inputFieldHasFocus=0.5};SearchAsYouType.prototype.handleInputMouseDown=function(){this.autocomplete&&this.collapseAutocomplete_()};SearchAsYouType.prototype.handleAutocompleteMouseDown=function(){this.autocomplete&&this.collapseAutocomplete_()};SearchAsYouType.prototype.handleInputClick=function(a){a=a||window.event;a.cancelBubble=!0;1==this.inputFieldHasFocus?this.resultsWindowHidden&&this.search_(!0):this.inputFieldHasFocus=1};
SearchAsYouType.prototype.handleSearchResultClick=function(a){a=a||window.event;for(a=a.target?a.target:a.srcElement;"DIV"!=a.tagName||-1==a.className.indexOf("searchResult");)a=a.parentNode;a.getAttribute("moreDetailsUrl")&&this.goToUrl_(a.getAttribute("moreDetailsUrl"))};SearchAsYouType.prototype.handleBodyClick=function(){this.clearAutocomplete_();this.hideResultsWindow_();this.resultsWindowHiddenByClicking=!0};
SearchAsYouType.prototype.goToUrl_=function(a){try{top.location!=location?top.location.href=a:location.href=a}catch(b){location.href=a}};
SearchAsYouType.prototype.activateDebugConsole_=function(){document.write("<div onclick='event.cancelBubble = true;' id='searchAsYouTypeDebugConsole' class='expanded'><div style='float: right'><button onclick='searchAsYouType.clearDebugConsoleTimes()'>Clear console</button><button onclick='searchAsYouType.clearCache()'>Clear cache</button><button onclick='searchAsYouType.toggleDebugConsole(event)'>Show/hide</button></div><h1>Search-as-you-type debug console</h1><br /><table id='searchAsYouTypeDebugTimes'></table></div>");this.debugConsoleTimesHeader=
'<tr><th>Query</th><th>Auto-completed</th><th>No. of results</th><th>Delay before<br />displaying:<br />(fixed)</th><th title="JS: Time from launching a query to displaying it">Total turn-around<br />client+server</th><th title="Ajax: Total time spent on the server">Server:<br />Total time</th></tr>';this.clearDebugConsoleTimes()};
SearchAsYouType.prototype.toggleDebugConsole=function(a){var b=document.getElementById("searchAsYouTypeDebugConsole");b.className=-1!=b.className.indexOf("expanded")?b.className.replace(/expanded/,"contracted"):b.className.replace(/contracted/,"expanded");a=a||window.event;a.cancelBubble=!0;this.inputFieldEl.focus()};
SearchAsYouType.prototype.addToDebugConsoleTimesNewLine_=function(a){this.debugConsoleTimesContents=this.debugConsoleTimesCurrentLine+this.debugConsoleTimesContents;this.debugConsoleTimesCurrentLine="<tr>"+a;document.getElementById("searchAsYouTypeDebugTimes").innerHTML=this.debugConsoleTimesHeader+this.debugConsoleTimesCurrentLine+this.debugConsoleTimesContents};
SearchAsYouType.prototype.addToDebugConsoleTimesCurrentLine_=function(a){this.debugConsoleTimesCurrentLine+=a;document.getElementById("searchAsYouTypeDebugTimes").innerHTML=this.debugConsoleTimesHeader+this.debugConsoleTimesCurrentLine+this.debugConsoleTimesContents};SearchAsYouType.prototype.clearDebugConsoleTimes=function(){this.debugConsoleTimesCurrentLine=this.debugConsoleTimesContents="";document.getElementById("searchAsYouTypeDebugTimes").innerHTML=this.debugConsoleTimesHeader;this.inputFieldEl.focus()};
SearchAsYouType.prototype.clearCache=function(){this.searchCache=[];this.inputFieldEl.focus()};function searchAsYouTypeBind(a,b,c){var d=a.boundArgs_||[],d=d.concat(Array.prototype.slice.call(arguments,2));"undefined"!=typeof a.boundSelf_&&(b=a.boundSelf_);"undefined"!=typeof a.foundFn_&&(a=a.boundFn_);var f=function(){var c=d.concat(Array.prototype.slice.call(arguments));return a.apply(b,c)};f.boundArgs_=d;f.boundSelf_=b;f.boundFn_=a;return f}
function searchAsYouTypeCloneObject(a){var b=a instanceof Array?[]:{},c;for(c in a)b[c]=-1!=a[c].constructor.toString().indexOf("Array")?searchAsYouTypeCloneObject(a[c]):"object"==typeof a[c]?searchAsYouTypeCloneObject(a[c]):a[c];return b}var searchAsYouType=new SearchAsYouType;try{searchAsYouTypeCallback&&searchAsYouTypeCallback()}catch(e$$29){};